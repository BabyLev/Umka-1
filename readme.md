# UMKA Server

### Краткое описание

Проект создавался изначально как тестовая работа для получения параметров спутника Umka-1, но затем перерос в веб-сервис, который позволяет работать с параметрами любого спутника. Проект, по крайней мере, двигается в эту сторону

### Дорожная карта (обновляется)

- [x] Добавить создание спутника через NORAD ID (добавить в схему данных). Если указаны обе линии и ID, то будет использоваться ID
- [x] Добавить запрос к API r4uab для получения актуальных данных
- [ ] Сделать кэш для хранения полученных данных. Обновлять раз в сутки


---

### Запуск

Чтобы запустить проект, нужно, чтобы на компьютере была версия Go не ниже, чем указанная в файле [go.mod](https://github.com/BabyLev/Umka-1/blob/main/go.mod)

TODO: сделать возможность выбора порта, на котором запускается веб сервер

По умолчанию, сервер запускается на `localhost:8080`

## Доступные HTTP ручки

- ### service.Calculate

Запрос:

`POST /calculate/`

Возвращает длину, широту, долготу и адрес спутника на карте

Пример запроса:

```json
{
  "satelliteId": 1,
  "timestamp": 1234567890 // timestamp in seconds, optional
}
```

Пример ответа:

```json
{
  "lat": -66.37755182682588,
  "lon": 46.50098627409187,
  "alt": 557.4210161450574,
  "gmapslink": "https://www.google.com/maps/place/-66.377552+46.500986"
}
```

---

- ### service.GetSatellite

Запрос:

`GET /satellite/{id}`

Возвращает спутник по переданному ID

Пример того, что можно получить на выходе:
``` json
{
    "line1":"1 1234U 56789G  1234.56789  .000000  00000-0",
    "line2":"7 7777  88888 99.000 1111  22.22333 33.444 555",
    "name":"123"
}

```

---

- ### service.LookAngles

`POST "/look-angles/"`

Возвращает азимут, элевацию и диапазон спутника


---

- ### service.VisibleTimeRange

"/time-ranges/"

Высчитывающая временные диапазоны, когда видно спутник над заданной точкой в нужном количестве


---

- ### service.FindSatellite

`POST "/satellite/"`

Возвращает все спутники по переданному пользователем имени.

Пример JSON:
``` json
{
"name": "123"
}
```
Пример того, что ручка может вернуть:
``` json
{
    "satellites":
        {"1":
            {"line1": "1 12345U 23091G   5555.99999  .00011108  00000",
            "line2": "1 12345U 23091G   5555.99999  .00011108  00000",
            "name": "123"
            },
        "2":
            {"line1": "1 5757U 3333G   12121.43210  .00011108  00000-0",
            "line2": "2 77777  1111 222.3333 0000  88.9999 123.0000",
            "name": "111"}
        }
}
```

---

- ### service.AddSatellite

`PUT /satellite/`

Добавляет переданный спутник в хранилище и возращает его ID

- Если "noradId" не передается, то для создания спутника в хранилище будут использованы "line1" и "line2" из запроса клиента
- Если "noradId" передается, то для создания спутника в хранилище будут использованы "line1" и "line2", взятые из спутника сервера "https://api.r4uab.ru" под таким "noradId"

Пример JSON:
``` json
{
    "line1": "1 12345U 23091G   5555.99999  .00011108  00000",
    "line2": "1 12345U 23091G   5555.99999  .00011108  00000",
    "name": "777",
    "noradId": 12345 // опционально
}
```
Пример того, что ручка может вернуть:
``` json
{
    "id": 1
}
```

--- 

- ### service.DeleteSatellite

`DELETE "/satellite/{id}"`

Удаляет спутник из хранилища по ID

Пример того, что ручка может вернуть:
```
"спутник успешно удалился id = 1"
```

---

- ### service.UpdateSatellite

`PATCH "/satellite/"`
 
- Если не передано "noradId", то перезаписывать его значение не надо
- Если передано "noradId", то в структуре нужного спутника в хранилище перезаписывается его значение, а также  значение "line1", "line2" и "name", которые были указаны в спутнике под таким "noradId" изначально

Пример JSON:
``` json
{
     "id": 5,
        "satellite": {
            "line1": "1 12345U 23091G   5555.99999  .00011108  99999",
            "line2": "1 12345U 23091G   5555.99999  .00011108  99999",
            "name": "TOP"
        }
}
```
